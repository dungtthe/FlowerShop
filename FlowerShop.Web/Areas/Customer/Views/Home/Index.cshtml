@using FlowerShop.DataAccess.Models;
@{
    var topSellingProducts = ViewBag.topSellingProducts as IEnumerable<Product>;
    var newProducts = (ValueTuple<IEnumerable<Product>, int, int>)ViewBag.newProducts;
    var giftProducts = (ValueTuple<IEnumerable<Product>, int, int>)ViewBag.giftProducts;
}


<div class="container-fluid py-5 mb-5 hero-header">
    <div class="container py-5">
        <div class="row g-5 align-items-center">
            <div class="col-md-12 col-lg-7">
                <h4 class="mb-3 text-secondary"></h4>
                <h1 class="mb-5 display-3 text-primary">
                    Hoa Yêu Thương – nhắn gửi yêu thương, cánh hoa dẫn đường!
                </h1>
                <!-- <div class="position-relative mx-auto">
                    <input class="form-control border-2 border-secondary w-75 py-3 px-4 rounded-pill" type="number"
                        placeholder="Search">
                    <button type="submit"
                        class="btn-custom  border-2 border-secondary py-3 px-4 position-absolute rounded-pill  h-100"
                        style="top: 0; right: 25%;">Submit Now</button>
                </div> -->
            </div>
            <div class="col-md-12 col-lg-5">
                <div id="carouselId" class="carousel slide position-relative" data-bs-ride="carousel">
                    <div class="carousel-inner" role="listbox">
                        <div class="carousel-item active rounded">
                            <img src="~/customer/img/hero-img-1.png" class="img-fluid w-100 h-100 bg-secondary rounded"
                                alt="First slide">
                            <a href="#" class="btn px-4 py-2 text-white rounded">Hoa sinh nhật</a>
                        </div>
                        <div class="carousel-item rounded">
                            <img src="~/customer/img/hero-img-2.jpg" class="img-fluid w-100 h-100 rounded"
                                alt="Second slide">
                            <a href="#" class="btn px-4 py-2 text-white rounded">Hoa cưới</a>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselId"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselId"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@* sản phẩm bán chạy *@

<div class="section-products">
    <div class="container">
        <div class="inner-tag" style="padding-bottom: 25px;">
            <h2 id="san-pham-ban-chay">Sản phẩm bán chạy</h2>
        </div>
        <div class="inner-products">
            <div class="row">
                @foreach (var item in topSellingProducts)
                {
                    await Html.RenderPartialAsync("_Product", item);
                }
            </div>
        </div>

    </div>
</div>



@*end sản phẩm bán chạy *@



@* mẫu hoa mới *@
<div class="section-products" style="margin-top: 50px;">
    <div class="container">
        <div class="inner-tag" style="padding-bottom: 25px;">
            <h2>Sản phẩm mới</h2>
        </div>
        <div class="inner-products">
            <div id="row-newproducts" class="row">
                @foreach (var item in newProducts.Item1)
                {
                    await Html.RenderPartialAsync("_Product", item);
                }
            </div>
            @if (newProducts.Item3 > 0)
            {
                <button id="btnViewmoreProducts" onclick="HandleClickViewmoreProducts()" class="button-view-more-products">
                    Xem thêm, còn @newProducts.Item3 sản phẩm <span style="font-size: 12px;">▼</span>
                </button>
            }
            <input readonly hidden id="ipPagination-newProducts" data-pageindexcur="0"
                data-remaining="@newProducts.Item3">
        </div>

    </div>
</div>
@* end mẫu hoa mới *@

<!-- quà tặng kèm  -->


@if (giftProducts.Item1.Count() != 0)
{
    <div class="section-products" style="margin-top: 50px;">
        <div class="container">
            <div class="inner-tag" style="padding-bottom: 25px;">
                <h2>Quà tặng kèm</h2>
            </div>
            <div class="inner-products">
                <div id="row-giftproducts" class="row">
                    @foreach (var item in giftProducts.Item1)
                    {
                        await Html.RenderPartialAsync("_Product", item);
                    }
                </div>
                @if (giftProducts.Item3 > 0)
                {
                    <button id="btnViewmoreGiftProductsProducts" onclick="HandleClickViewmoreGiftProductsProducts()"
                        class="button-view-more-products">
                        Xem thêm, còn @giftProducts.Item3 sản phẩm <span style="font-size: 12px;">▼</span>
                    </button>
                }
                <input readonly hidden id="ipPagination-giftProducts" data-pageindexcur="0"
                    data-remaining="@giftProducts.Item3">
            </div>

        </div>
    </div>
}
<!-- end quà tặng kèm -->


@* Tại sao bạn nên dùng dịch vụ của Chúng tôi? *@
<div class="container-fluid py-5" style="margin-top: 70px;">
    <div class="container">
        <div class="text-center mx-auto mb-5" style="max-width: 1000px;">
            <h3 class="display-12">Tại sao bạn nên dùng dịch vụ của Chúng tôi?</h3>
        </div>
        <div class="bg-light p-5 rounded">
            <div class="row g-4 justify-content-center">
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="counter bg-white rounded p-5">
                        <i class="fa fa-users text-secondary"></i>
                        <h4>khách hàng hài lòng</h4>
                        <h1>1963</h1>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="counter bg-white rounded p-5">
                        <i class="fa fa-users text-secondary"></i>
                        <h4>chất lượng dịch vụ</h4>
                        <h1>99%</h1>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="counter bg-white rounded p-5">
                        <i class="fa fa-users text-secondary"></i>
                        <h4>chứng chỉ chất lượng</h4>
                        <h1>33</h1>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="counter bg-white rounded p-5">
                        <i class="fa fa-users text-secondary"></i>
                        <h4>Sản phẩm có sẵn</h4>
                        <h1>789</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Fact Start -->
<!-- Tastimonial Start -->
<div class="container-fluid testimonial py-5">
    <div class="container py-5">
        <div id="customer-said" class="text-center mx-auto mb-5" style="max-width: 1000px;">
            <h3 class="display-12">Khách hàng nói gì về chúng tôi?</h3>
        </div>
        <div class="owl-carousel testimonial-carousel">
            <div class="testimonial-item img-border-radius bg-light rounded p-4">
                <div class="position-relative">
                    <i class="fa fa-quote-right fa-2x text-secondary position-absolute"
                        style="bottom: 30px; right: 0;"></i>
                    <div class="mb-4 pb-4 border-bottom border-secondary">
                        <p class="mb-0">
                            Lorem Ipsum is simply dummy text of the printing Ipsum has been the
                            industry's standard dummy text ever since the 1500s,
                        </p>
                    </div>
                    <div class="d-flex align-items-center flex-nowrap">
                        <div class="bg-secondary rounded">
                            <img src="~/customer/img/testimonial-1.jpg" class="img-fluid rounded"
                                style="width: 100px; height: 100px;" alt="">
                        </div>
                        <div class="ms-4 d-block">
                            <h4 class="text-dark">Client Name</h4>
                            <p class="m-0 pb-3">Profession</p>
                            <div class="d-flex pe-5">
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="testimonial-item img-border-radius bg-light rounded p-4">
                <div class="position-relative">
                    <i class="fa fa-quote-right fa-2x text-secondary position-absolute"
                        style="bottom: 30px; right: 0;"></i>
                    <div class="mb-4 pb-4 border-bottom border-secondary">
                        <p class="mb-0">
                            Lorem Ipsum is simply dummy text of the printing Ipsum has been the
                            industry's standard dummy text ever since the 1500s,
                        </p>
                    </div>
                    <div class="d-flex align-items-center flex-nowrap">
                        <div class="bg-secondary rounded">
                            <img src="~/customer/img/testimonial-1.jpg" class="img-fluid rounded"
                                style="width: 100px; height: 100px;" alt="">
                        </div>
                        <div class="ms-4 d-block">
                            <h4 class="text-dark">Client Name</h4>
                            <p class="m-0 pb-3">Profession</p>
                            <div class="d-flex pe-5">
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="testimonial-item img-border-radius bg-light rounded p-4">
                <div class="position-relative">
                    <i class="fa fa-quote-right fa-2x text-secondary position-absolute"
                        style="bottom: 30px; right: 0;"></i>
                    <div class="mb-4 pb-4 border-bottom border-secondary">
                        <p class="mb-0">
                            Lorem Ipsum is simply dummy text of the printing Ipsum has been the
                            industry's standard dummy text ever since the 1500s,
                        </p>
                    </div>
                    <div class="d-flex align-items-center flex-nowrap">
                        <div class="bg-secondary rounded">
                            <img src="~/customer/img/testimonial-1.jpg" class="img-fluid rounded"
                                style="width: 100px; height: 100px;" alt="">
                        </div>
                        <div class="ms-4 d-block">
                            <h4 class="text-dark">Client Name</h4>
                            <p class="m-0 pb-3">Profession</p>
                            <div class="d-flex pe-5">
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                                <i class="fas fa-star text-primary"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    // Đảm bảo mã cuộn chạy sau khi trang tải xong
    window.addEventListener('load', function () {
        // Kiểm tra xem URL có chứa hash hay không
        const hash = window.location.hash;
        if (hash) {
            // Lấy phần tử theo hash (ví dụ: #san-pham-ban-chay)
            const element = document.querySelector(hash);
            if (element) {
                // Cuộn đến phần tử với hiệu ứng smooth
                element.scrollIntoView({ behavior: "smooth" });
                console.log("Đã cuộn đến phần tử " + hash);
            } else {
                console.log("Không tìm thấy phần tử " + hash);
            }
        }
    });


    const HandleClickViewmoreProducts = () => {
        const elementInput = document.getElementById("ipPagination-newProducts");
        const pageIndexCur = elementInput.getAttribute("data-pageindexcur");
        const uri = "/api/product/newproducts?pageIndexCur=" + pageIndexCur;
        let rowProducts = document.getElementById("row-newproducts");
        fetchGet(
            uri,
            (data) => {
                console.log(data);
                elementInput.setAttribute("data-pageindexcur", data.pageIndexCur);
                elementInput.setAttribute("data-remaining", data.remaining);
                const btnViewmore = document.getElementById("btnViewmoreProducts");
                btnViewmore.innerHTML = `Xem thêm, còn ${data.remaining} sản phẩm <span style="font-size: 12px;">▼</span>`;
                if (data.remaining <= 0) {
                    btnViewmore.style.display = "none";
                }
                for (const p of data.products) {
                    let boxproduct;
                    if (p.priceDefault > p.priceSale) {
                        boxproduct = `
                                        <div class="box-product col-custom">
                                            <div class="inner-wrap">
                                                <div class="inner-image" onClick="DetailProduct(${p.id})">
                                                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">
                                                                SALE
                                                            </div>
                                                            <img src="${p.image}" alt="ảnh sản phẩm" style="mix-blend-mode: multiply; !important">
                                                        <div class="inner-icon" onclick="AddProductToCart(${p.id},1)">
                                                            <i class="bi bi-cart-plus"></i>
                                                        </div>
                                                </div>
                                                <div class="inner-content">
                                                    <h3 class="inner-title">${p.title}</h3>
                                                    <div class="inner-price">
                                                            <p class="price-old">${convertToVietnameseDong(p.priceDefault)}</p>
                                                        <p class="price-current">${convertToVietnameseDong(p.priceSale)}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        `;
                    }
                    else {
                        boxproduct = `
                                    <div class="box-product col-custom">
                                    <div class="inner-wrap">
                                        <div class="inner-image" onClick="DetailProduct(${p.id})">

                                                    <img src="${p.image}" alt="ảnh sản phẩm" style="mix-blend-mode: multiply; !important">
                                                <div class="inner-icon" onclick="AddProductToCart(${p.id},1)">
                                                    <i class="bi bi-cart-plus"></i>
                                                </div>
                                        </div>
                                        <div class="inner-content">
                                            <h3 class="inner-title">${p.title}</h3>
                                            <div class="inner-price">
                                                <p class="price-current">${convertToVietnameseDong(p.priceSale)}</p>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                    `;
                    }
                    rowProducts.innerHTML += boxproduct;
                }

            },
            () => { },
            () => { }
        );
    };




    const HandleClickViewmoreGiftProductsProducts = () => {
        const elementInput = document.getElementById("ipPagination-giftProducts");
        const pageIndexCur = elementInput.getAttribute("data-pageindexcur");
        const uri = "/api/product/giftproducts?pageIndexCur=" + pageIndexCur;
        let rowProducts = document.getElementById("row-giftproducts");
        fetchGet(
            uri,
            (data) => {
                console.log(data);
                elementInput.setAttribute("data-pageindexcur", data.pageIndexCur);
                elementInput.setAttribute("data-remaining", data.remaining);
                const btnViewmore = document.getElementById("btnViewmoreGiftProductsProducts");
                btnViewmore.innerHTML = `Xem thêm, còn ${data.remaining} sản phẩm <span style="font-size: 12px;">▼</span>`;
                if (data.remaining <= 0) {
                    btnViewmore.style.display = "none";
                }
                for (const p of data.products) {
                    let boxproduct;
                    if (p.priceDefault > p.priceSale) {
                        boxproduct = `
                                        <div class="box-product col-custom">
                                            <div class="inner-wrap">
                                                <div class="inner-image" onClick="DetailProduct(${p.id})">
                                                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">
                                                                SALE
                                                            </div>
                                                            <img src="${p.image}" alt="ảnh sản phẩm" style="mix-blend-mode: multiply; !important">
                                                        <div class="inner-icon" onclick="AddProductToCart(${p.id},1)">
                                                            <i class="bi bi-cart-plus"></i>
                                                        </div>
                                                </div>
                                                <div class="inner-content">
                                                    <h3 class="inner-title">${p.title}</h3>
                                                    <div class="inner-price">
                                                            <p class="price-old">${convertToVietnameseDong(p.priceDefault)}</p>
                                                        <p class="price-current">${convertToVietnameseDong(p.priceSale)}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        `;
                    }
                    else {
                        boxproduct = `
                                    <div class="box-product col-custom">
                                    <div class="inner-wrap">
                                        <div class="inner-image" onClick="DetailProduct(${p.id})">

                                                    <img src="${p.image}" alt="ảnh sản phẩm" style="mix-blend-mode: multiply; !important">
                                                <div class="inner-icon" onclick="AddProductToCart(${p.id},1)">
                                                    <i class="bi bi-cart-plus"></i>
                                                </div>
                                        </div>
                                        <div class="inner-content">
                                            <h3 class="inner-title">${p.title}</h3>
                                            <div class="inner-price">
                                                <p class="price-current">${convertToVietnameseDong(p.priceSale)}</p>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                    `;
                    }
                    rowProducts.innerHTML += boxproduct;
                }

            },
            () => { },
            () => { }
        );
    };
</script>